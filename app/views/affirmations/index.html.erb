<div class="w-full p-0" id="affirmations-container text-white">
  <div class="bg-white shadow-lg rounded-none bg-opacity-50">
    <!-- Sticky Top Navigation Bar -->
    <nav class="sticky top-0 z-10 w-full left-0 bg-white/50 flex flex-wrap items-center justify-between gap-4 px-4 py-3 shadow-md bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 shadow-lg" >
      <h1 class="text-2xl md:text-3xl font-bold text-gray-50 mr-4">Daily Affirmations</h1>
      <!-- Date Navigation -->
      <div class="flex items-center gap-2">      
        <%= link_to affirmations_path(date: @date - 1.day), class: "inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 text-purple-200 hover:text-white hover:bg-white/20" do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left w-4 h-4 mr-1" aria-hidden="true"><path d="m15 18-6-6 6-6"></path></svg>
          <span>Prev</span>
        <% end %>
        <div class="text-purple-100 px-3 py-1 bg-white/20 rounded-lg backdrop-blur-sm">
          <%= @date.strftime("%B %d, %Y") %>
        </div>
        <% if @date < Date.current %>
          <%= link_to affirmations_path(date: @date + 1.day), class: "inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:hover:bg-accent/50 h-8 rounded-md gap-1.5 px-3 text-purple-200 hover:text-white hover:bg-white/20" do %>
            <span>Next</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right w-4 h-4 ml-1" aria-hidden="true"><path d="m9 18 6-6-6-6"></path></svg>
          <% end %>
        <% end %>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <!-- Model Selection -->
        <%= form_with url: generate_today_affirmations_path, method: :get, local: true, class: " bg-white/20 rounded-lg backdrop-blur-sm flex items-center gap-2 text-white backdrop-blur-sm" do %>
          <% if @models.present? %>
            <%= select_tag :model, options_for_select(@models, selected: @selected_model),
                { class: "border rounded px-3 py-2", onchange: "this.form.submit();" } %>
          <% else %>
            <p class="text-red-500">No models available.</p>
          <% end %>
        <% end %>
                <!-- Clear Today Button -->
        <% if @affirmations.any? %>
          <%= form_with url: clear_today_affirmations_path, method: :delete, local: true do %>
            <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" onclick="return confirm('This will delete all of today\'s affirmations. Continue?')">
              Clear Today
            </button>
          <% end %>
        <% end %>

        <!-- Generate Button -->
        <%= form_with url: generate_today_affirmations_path, method: :post, local: true do %>
          <%= hidden_field_tag :date, @date %>
          <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" onclick="return confirm('This will generate affirmations for the selected date. Continue?')">
            Generate for <%= @date.strftime("%B %d, %Y") %>
          </button>
        <% end %>
      </div>
    </nav>
    <div class="max-w-6xl mx-auto px-6 py-8">
      <!-- Category Filter -->
      <div class="flex justify-center mb-8">
        <%= form_with url: affirmations_path, method: :get, local: true, class: "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex items-center justify-between gap-2 rounded-md px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 w-48 bg-white/70 backdrop-blur-sm shadow-lg border-0" do |f| %>
          <%= f.hidden_field :date, value: @date %>
          <%= f.select :category,
              options_for_select([["All Categories", ""]] + @categories.map { |c| [c.titleize, c] }, @selected_category),
              {},
              { class: "border rounded px-3 py-2", onchange: "this.form.submit();" } %>
        <% end %>
      </div>
      <!-- Affirmations Display -->
      <div id="affirmations">
        <%= turbo_stream_from "affirmations" %>
        <%= render @affirmations %>
      </div>
    </div>
    <!-- Favorites Section -->
    <% if @favorites.any? %>
      <div class="mt-12 pt-8 border-t border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">⭐ Your Favorites</h2>
        <div class="grid gap-3 md:grid-cols-2">
          <% @favorites.each do |favorite| %>
            <div class="bg-yellow-50 rounded-lg p-4 border border-yellow-200">
              <div class="text-sm text-yellow-600 mb-1">
                <%= favorite.category.titleize %> • <%= favorite.date.strftime("%b %d") %>
              </div>
              <blockquote class="text-gray-800 font-medium">
                "<%= favorite.content %>"
              </blockquote>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  function speakText(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    window.speechSynthesis.speak(utterance);
  }
</script>
